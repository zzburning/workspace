/*******************************************************************************************
 * 					Filename: exclog_query.h
 ********************************************************************************************
 * Description:
 * 		this is a file header of exclog_query.c for libexcLOG. 
 * Version:
 * 	    V_0.1 Aug-14-2010
 * Copyright:
 * Author: 
 * History:
 * 		 V_0.1 Initial version of this code.
 ********************************************************************************************/
#ifndef __EXCLOG_QUERY_H_
#define __EXCLOG_QUERY_H_

#include "exclog.h"

/**
 * Defination of query information
 **/
typedef struct
{
	/**
	 * current query request
	 **/
	exclog_query_req_t req;

	/**
	 * current query region index 
	 **/
	int region_index;

	/**
	 * position of region
	 **/
	int region_pos;

	/**
	 * current query response num,max=EXCLOG_RESPONSE_NUM_MAX
	 **/
	int rps_num;
} exclog_query_info_t;

/********************************************************************************************
 * Function: _exclog_query_req_check()
 *----------------------------------------------------------------------------------------------------------------------------------------
 * Description: check validity of query request.
 *---------------------------------------------------------------------------------------------------------------------------------------- 
 * Parameters:
 * @ req:IN,query request to check.
 *---------------------------------------------------------------------------------------------------------------------------------------- 
 * Return :
 * 		 0:valid.
 * 		 1:start time invalid.
 * 		 2:end time invalid.
 * 		 3:start time > end time.
 * 		 4:level invalid.
 * 		 5:module invalid.
 * 		 6:req is null.
 ********************************************************************************************/
int _exclog_query_check_req(const exclog_query_req_t *req);

/********************************************************************************************
 * Function: _exclog_query_startup()
 *----------------------------------------------------------------------------------------------------------------------------------------
 * Description: start to query log from local.
 *---------------------------------------------------------------------------------------------------------------------------------------- 
 * Parameters:
 * @ ip: IN,IP address of query request.
 * @ rps: OUT,query result.
 *---------------------------------------------------------------------------------------------------------------------------------------- 
 * Return :
 * 		 0:success.
 *    -1:fail.
 ********************************************************************************************/
int _exclog_query_startup(char *ip, exclog_query_rps_t **rps);

/********************************************************************************************
 * Function: _exclog_query_stop()
 *----------------------------------------------------------------------------------------------------------------------------------------
 * Description: stop query,free log in rps list which is not read by user yet.
 *----------------------------------------------------------------------------------------------------------------------------------------
 * Parameters:
 *----------------------------------------------------------------------------------------------------------------------------------------
 * Return :NULL.
 ********************************************************************************************/
void _exclog_query_stop(void);

/********************************************************************************************
 * Function: _exclog_query_free()
 *----------------------------------------------------------------------------------------------------------------------------------------
 * Description: free query result.
 *----------------------------------------------------------------------------------------------------------------------------------------
 * Parameters:
 * @ rps: IN,query result.
 *----------------------------------------------------------------------------------------------------------------------------------------
 * Return :NULL.
 ********************************************************************************************/
void _exclog_query_free(exclog_query_rps_t *rps);

/********************************************************************************************
 * Function: _exclog_query_from_remote()
 *----------------------------------------------------------------------------------------------------------------------------------------
 * Description:query log from remote.
 *---------------------------------------------------------------------------------------------------------------------------------------- 
 * Parameters:
 * @ req: IN,query request.
 * @ rps: OUT,query result.
 *---------------------------------------------------------------------------------------------------------------------------------------- 
 * Return :
 * 		 0:success.
 *   	   -1:fail.
 ********************************************************************************************/
int _exclog_query_from_remote(exclog_query_req_t *req, exclog_query_rps_t **rps);

#endif/*__EXCLOG_STORE_H_*/
